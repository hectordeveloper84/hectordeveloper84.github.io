openapi: 3.1.1
info:
  title: API Servicios ERP para sistemas de fábrica
  description: Detalle de los servicios proporcinados por el software del ERP que son llamadas desde sistemas externos como sistemas de fábrica
   para guardar información en el ERP. Tambien ser ofrecen servicios de consulta para poder consultar desde sistemas externos información de fábrica
   almacenada en el ERP.
  version: 1.0.0
servers:
  - url: https://server.erp.com
tags:
  - name: Recepciones
    description: Servicios de recepciones de materia prima
  - name: Expediciones
    description: Servicios de expediciones de pienso
  - name: Fórmulas
    description: Servicios de fórmulas
  - name: Pedidos de pienso
    description: Servicios de Pedidos de pienso
  - name: Regularizaciones
    description: Servicios de Regularizaciones
  - name: Producciones
    description: Servicios de Producciones
paths:
  /recepciones:
    post:
      tags:
        - Recepciones
      summary: Crear o registrar recepciones de materia prima
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Recepciones"
      responses:
        '200':
          description: Recepción procesada correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples: 
                      - Se ha guardado correctamente.
                  code:
                    type: string
                    enum: [OK, NOK]
                    examples: 
                      - OK
        '500':
          description: Error al procesar la recepción
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples: 
                      - Se debe rellenar el campo producto.
                  code:
                    type: string
                    examples: 
                      - NOK    
  /expediciones:
    post:
      tags:
        - Expediciones
      summary: Obtener en el erp expediciones de pienso realizardas desde fábrica
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Expediciones'
      responses:
        '200':
          description: Expediciones recibidas correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples: 
                      - Expediciones procesadas correctamente
        '400':
          description: Solicitud incorrecta
        '500':
          description: Error interno del servidor
  /pedidos:
    post:
      tags:
        - Pedidos de pienso
      summary: Obtener en el erp pedidos de pienso realizardas desde fábrica
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pedidos'
      responses:
        '200':
          description: pedidos recibidas correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples: 
                      - pedidos procesadas correctamente
        '400':
          description: Solicitud incorrecta
        '500':
          description: Error interno del servidor
  /regularizaciones:
    post:
      tags:
        - Regularizaciones
      summary: guardar en el erp regularizaciones de pienso o materia prima realizardas desde fábrica
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Regularizaciones'
      responses:
        '200':
          description: regularizaciones recibidas correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples: 
                      - Regularizaciones procesadas correctamente
        '400':
          description: Solicitud incorrecta
        '500':
          description: Error interno del servidor
  /producciones:
    post:
      tags:
        - Producciones
      summary: guardar en el erp producciones (con sus consumos) de pienso realizadas desde fábrica
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Producciones'
      responses:
        '200':
          description: Producciones recibidas correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples: 
                      - Producciones procesadas correctamente
        '400':
          description: Solicitud incorrecta
        '500':
          description: Error interno del servidor
components:
  schemas:
    Recepciones:
      type: object
      required:
        - mensajeId
        - fechaCreacion
        - origen
        - recepciones
      properties:
        mensajeId:
          type: string
          format: uuid
          description: Identificador del mensaje
        fechaCreacion:
          type: string
          format: date-time
          description: Fecha de creación en formato ISO 8601 con franja horaria
          examples: 
            - 2025-07-09T10:15+02:00
        origen:
          type: string
          description: Identificador del sistema origen
          examples: 
            - D365
        recepciones:
          type: array
          items:
            type: object
            required:
              - viajeAemes
            properties:
              viajeAemes:
                type: string
                description: Número de identificación interna de aemes
              codigoExterno:
                type: string
                description: Identificador de la recepción (referencia transportista)
              fecha:
                type: string
                format: date-time
                description: Fecha en formato ISO 8601 con franja horaria
                examples: 
                  - 2025-07-09T10:15+02:00
              matriculaVehiculo:
                type: string
              matriculaRemolque:
                type: string
              transportista:
                type: string
              conductor:
                type: string
              fechaEntrada:
                type: string
                format: date-time
                description: Fecha de entrada en formato ISO 8601 con franja horaria
                examples: 
                  - 2025-07-09T10:15+02:00
              pesoEntrada:
                type: number
                format: float
              fechaSalida:
                type: string
                format: date-time
                description: Fecha de salida en formato ISO 8601 con franja horaria
                examples: 
                  - 2025-07-09T10:15+02:00
              pesoSalida:
                type: number
                format: float
              estado:
                type: string
                enum: [P, C, R]
              codigoRechazo:
                type: string
              reenviado:
                type: string
                enum: [S, N]
              lineas:
                type: array
                items:
                  type: object
                  required:
                    - id
                    - numeroLinea
                    - producto
                    - cantidadTeorica
                    - cantidadReal
                  properties:
                    id:
                      type: string
                    numeroLinea:
                      type: integer
                    producto:
                      type: string
                    presentacion:
                      type: string
                    numerosEnvases:
                      type: integer
                    codigoEnvase:
                      type: string
                    cantidadTeorica:
                      type: number
                      format: float
                    cantidadReal:
                      type: number
                      format: float
                    proveedor:
                      type: string
                    aplicacion:
                      type: string
                    loteProveedor:
                      type: string
                    loteEntrada:
                      type: string
                    fechaCaducidadLote:
                      type: string
                    codigoMuestra:
                      type: string
                    codigoRecipiente:
                      type: string
                    referenciaProveedor:
                      type: string
                    calidad:
                      type: array
                      items:
                        type: object
                        properties:
                          codigoCalidad:
                            type: integer
                          descripcion:
                            type: string
                          valor:
                            type: number
                            format: double
    Expediciones:
      type: object
      required:
        - mensajeId
        - fechaCreacion
        - origen
        - expediciones
      properties:
        mensajeId:
          type: string
          format: uuid
          description: Identificador del mensaje
        fechaCreacion:
          type: string
          format: date-time
          description: Fecha de creación en formato ISO 8601 con franja horaria
          examples: 
            - 2025-07-09T10:15+02:00
        origen:
          type: string
          description: Identificador del origen
          examples: 
            - D365
        contenidoExpediciones:
          type: object
          properties:
            expedicion:
              type: object
              properties:
                viajeAEMES:
                  type: string
                codigoExterno:
                  type: string
                fechaPrevista:
                  type: string
                  format: date-time
                fechaRealizacion:
                  type: string
                matriculaRemolque:
                  type: string
                transportista:
                  type: string
                pesoEntrada:
                  type: number
                  format: double
                fechaPesoEntrada:
                  type: string
                  format: date-time
                estado:
                  type: string
                  description: El estado de la expedición
                  enum:
                    - E
                    - P
                    - T
                    - C
                  x-enum-descriptions:
                    E: Expedición en edición
                    P: Expedición pendiente de expedir
                    T: Expedición en tránsito (Pendiente de la confirmación del camionero de la entrega)
                    C: Expedición cerrada
                    R: Expedición rechazar
                reenviado:
                  type: string
                lineas:
                  type: object
                  properties:
                    linea:
                      type: array
                      items:
                        type: object
                        properties:
                          numeroLinea:
                            type: string
                          producto:
                            type: string
                          presentacion:
                            type: string
                          cliente:
                            type: string
                          explotacion:
                            type: string
                          almacenExplotacion:
                            type: string
                          pedido:
                            type: string
                          pedidoLinea:
                            type: string
                          pedidoCodigoCliente:
                            type: string
                          fechaEntrega:
                            type: string
                            format: date-time
                          fechaRealizacion:
                            type: string
                          loteSalida:
                            type: string
                          detalle3:
                            type: string
                          detalle4:
                            type: string
                          detalle8:
                            type: string
                          cantidades:
                            type: object
                            properties:
                              loteFabricacion:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    id:
                                      type: integer
                                    codigoLote:
                                      type: string
                                    compartimento1:
                                      type: number
                                    compartimento2:
                                      type: number
                                    compartimento3:
                                      type: number
                                    total:
                                      type: number

    Pedidos:
      type: object
      properties:
        mensajeId:
          type: string
          format: uuid
        fechaCreacion:
          type: string
          format: date-time
          description: Fecha de creación en formato ISO 8601 con franja horaria
          examples: 
            - 2025-07-09T10:15+02:00
        origen:
          type: string
          examples: 
            - D365
        contenidoPedidos:
          type: object
          properties:
            pedido:
              type: object
              properties:
                accion:
                  type: string
                codigoExterno:
                  type: string
                estado:
                  type: string
                pedidoCliente:
                  type: string
                fecha:
                  type: string
                  format: date
                cliente:
                  type: string
                explotacion:
                  type: string
                transportista:
                  type: string
                vehiculo:
                  type: string
                conductor:
                  type: string
                observaciones:
                  type: string
                lineas:
                  type: object
                  properties:
                    linea:
                      type: object
                      properties:
                        numeroLinea:
                          type: string
                        producto:
                          type: string
                        presentacion:
                          type: string
                        codigoEnvase:
                          type: string
                        numeroEnvases:
                          type: number
                        cantidadGranel:
                          type: number
                        loteFabricacion:
                          type: string
                        almacenExplotacion:
                          type: string
                        prioridad:
                          type: string
                        fechaEntrega:
                          type: string
                          format: date
                        observaciones:
                          type: string
    Regularizaciones:
      type: object
      properties:
        mensajeId:
          type: string
          format: uuid
        fechaCreacion:
          type: string
          format: date-time
          description: Fecha de creación en formato ISO 8601 con franja horaria
          examples: 
            - 2025-07-09T10:15+02:00
        origen:
          type: string
          examples: 
            - D365
        contenidoRegularizaciones:
          type: object
          properties:
            regularizacion:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                  producto:
                    type: string
                  presentacion:
                    type: string
                  cantidad:
                    type: number
                    format: double
                  fecha:
                    type: string
                    format: date-time
                    description: Fecha en formato ISO 8601 con franja horaria
                    examples: 
                      - 2025-07-09T10:15+02:00
                  loteFabrica:
                    type: string
                    description: Lote que asigna el sistema de fábrica en la recepcion de materia prima o produccion de pienso
    Producciones:
      type: object
      properties:
        mensajeId:
          type: string
          format: uuid
        fechaCreacion:
          type: string
          format: date-time
          description: Fecha de creación en formato ISO 8601 con franja horaria
          examples: 
            - 2025-07-09T10:15+02:00
        origen:
          type: string
          examples: 
            - D365
        conetnidoFabricaciones:
          type: object
          properties:
            fabricacion:
              type: object
              properties:
                fechaProduccion:
                  type: string
                  format: date-time
                  description: Fecha de producción en formato ISO 8601 con franja horaria
                  examples: 
                    - 2025-07-09T10:15+02:00
                identificadorProduccion:
                  type: string
                movimientos:
                  type: object
                  properties:
                    consumidos:
                      type: object
                      properties:
                        consumido:
                          type: array
                          items:
                            type: object
                            properties:
                              codigoProducto:
                                type: string
                              presentacion:
                                type: string
                              cantidad:
                                type: number
                                format: double
                              loteRecepcion:
                                type: string
                                description: Lote del proveedor de materia prima
                              loteFabrica:
                                description: Lote que asigna el sistema de fábrica en la recepcion de materia prima
                                type: string
                    producidos:
                      type: object
                      properties:
                        producido:
                          type: array
                          items:
                            type: object
                            properties:
                              codigoProducto:
                                type: string
                              presentacion:
                                type: string
                              cantidad:
                                type: number
                                format: double
                              loteFabricacion:
                                type: string
                                description: Lote que asigna el sistema de fábrica en la fabricación de pienso
  securitySchemes:
    oauth2:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: https://login.microsoftonline.com/vallcompanys.es/oauth2/token
          scopes:
            "lectura": Permiso de escritura
            "escritura": Permiso de lectura
security:
  - oauth2:
      - lectura
      - escritura       
